# OpenStack API Honeypot System

This project implements a honeypot system that mimics OpenStack APIs to detect and monitor potential attackers. The system includes logging and monitoring capabilities through Grafana and Loki.

## Project Overview

The OpenStack API Honeypot System consists of several services:

1. **Nginx Gateway** - Serves as a reverse proxy, routing requests to either the real mock OpenStack API or the honeypot, based on configuration.
2. **Mock OpenStack** - A simplified mock of the OpenStack API that responds to legitimate requests.
3. **Mock Honeypot** - A honeypot service that looks like OpenStack but tracks potential attackers, recording their behavior and interaction patterns.
4. **Loki** - Log aggregation system for collecting and querying logs.
5. **Promtail** - Log collection agent that ships logs to Loki.
6. **Grafana** - Visualization and monitoring dashboard.

## System Architecture

```
                                 ┌─────────────────┐
                                 │                 │
                       ┌─────────►  Mock OpenStack │
                       │         │                 │
                       │         └─────────────────┘
┌──────────────┐       │
│              │       │
│ Nginx Gateway├───────┤
│              │       │         ┌─────────────────┐
└──────────────┘       │         │                 │
                       └─────────►  Mock Honeypot  │
                                 │                 │
                                 └─────────────────┘
┌──────────────┐       ┌─────────────────┐       ┌─────────────────┐
│              │       │                 │       │                 │
│   Promtail   ├───────►      Loki       ├───────►     Grafana     │
│              │       │                 │       │                 │
└──────────────┘       └─────────────────┘       └─────────────────┘
```

## Prerequisites

- Docker and Docker Compose installed on your system
- Git (for cloning the repository)

## Getting Started

### Clone the Repository

```bash
git clone https://github.com/yourusername/openstack-honeypot.git
cd openstack-honeypot
```

### Directory Structure

```
openstack-honeypot/
├── docker-compose.yml          # Main docker-compose configuration file
├── nginx/                      # Nginx configuration
│   ├── Dockerfile
│   └── nginx.conf
├── mock-openstack/             # Mock OpenStack service
│   ├── Dockerfile
│   ├── app.py
│   └── requirements.txt
├── mock-honeypot/              # Mock Honeypot service
│   ├── Dockerfile
│   ├── app.py
│   └── requirements.txt
├── promtail/                   # Promtail configuration
│   └── config.yaml
├── grafana/                    # Grafana configuration
│   └── provisioning/
│       ├── dashboards/
│       └── datasources/
└── README.md                   # This file
```

### Running the System

To start the entire system, run:

```bash
docker-compose up -d
```

This will:
1. Build all necessary Docker images
2. Create and start containers for each service
3. Set up networking between containers
4. Mount volumes for persistent data

To stop the system:

```bash
docker-compose down
```

If you want to remove the volumes as well:

```bash
docker-compose down -v
```

## Accessing the Services

Once the system is running, you can access the following services:

- **Mock OpenStack API**: http://localhost:8080/v2/ or http://localhost:8080/v3/
- **Grafana Dashboard**: http://localhost:3000 (default login: admin/admin)
- **Loki API**: http://localhost:3100

## Viewing Logs

### Terminal Logs

To view logs for a specific service in the terminal:

```bash
# View logs for all services
docker-compose logs

# View logs for a specific service
docker-compose logs nginx-gateway
docker-compose logs mock-openstack
docker-compose logs mock-honeypot

# Follow logs (stream in real time)
docker-compose logs -f

# Show last N lines
docker-compose logs --tail=100 mock-honeypot
```

### Grafana Logs

1. Open Grafana at http://localhost:3000
2. Log in with username `admin` and password `admin`
3. Navigate to the "Explore" section
4. Select "Loki" as the data source
5. Use LogQL queries to filter logs, for example:
   - `{container_name="openstack-honeypot_mock-honeypot_1"}`
   - `{container_name=~".*nginx.*"} |= "error"`

## Configuration Files

### docker-compose.yml

The main configuration file that defines all services and their relationships. Key configurations include:
- Ports mapping for each service
- Volume mounts for persistent data
- Network configuration
- Dependencies between services

### nginx/nginx.conf

The Nginx configuration file that sets up the reverse proxy. This determines which requests get routed to the mock OpenStack service and which go to the honeypot.

### promtail/config.yaml

Configures how Promtail collects logs from the services and sends them to Loki.

### grafana/provisioning/

Contains configuration files for Grafana, including dashboard definitions and data source configurations.

## Honeypot Features

The honeypot service:
- Tracks user sessions and builds a profile of attacker behavior
- Assigns an "interaction level" based on how deeply attackers probe the system
- Provides increasingly interesting fake data to entice attackers to reveal their techniques
- Captures and logs all requests, headers, and payloads for later analysis

## Mock OpenStack Features

The mock OpenStack service:
- Provides simplified responses that mimic real OpenStack API responses
- Logs all requests for monitoring and debugging
- Includes basic health check endpoints

## Customization

### Modifying the Honeypot Behavior

Edit `mock-honeypot/app.py` to change how the honeypot responds to different requests or to adjust the interaction level logic.

### Changing Nginx Routing

Edit `nginx/nginx.conf` to modify how requests are routed between the mock OpenStack service and the honeypot.

### Adding Custom Grafana Dashboards

Add JSON dashboard definitions to `grafana/provisioning/dashboards/`.

## Security Considerations

- This system is designed for research and monitoring purposes
- In production environments, consider adding authentication to admin endpoints
- Regularly review logs to identify potential threats
- Consider isolating the honeypot network from production systems

## Troubleshooting

### Common Issues

1. **Services not starting properly**:
   - Check logs with `docker-compose logs <service-name>`
   - Ensure all ports are available and not in use by other applications

2. **Nginx not routing properly**:
   - Verify nginx.conf configuration
   - Check Nginx logs with `docker-compose logs nginx-gateway`

3. **Loki/Grafana integration issues**:
   - Verify Loki is healthy with `curl http://localhost:3100/ready`
   - Check Grafana datasource configuration

## License

[Your license information here]

## Contributing

[Your contribution guidelines here]

## Acknowledgements

[Your acknowledgements here]